<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis | Mongo Blog</title>
    <meta name="description" content="A VitePress Blog">
    <meta name="generator" content="VitePress v1.0.0-rc.45">
    <link rel="preload stylesheet" href="/assets/style.Ca9TNGG-.css" as="style">
    
    <script type="module" src="/assets/app.CG_k_zgx.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.Bx6qu0xe.js">
    <link rel="modulepreload" href="/assets/chunks/theme.CjF6jIsG.js">
    <link rel="modulepreload" href="/assets/note_RabbitMQ.md.Bo6iruvz.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-09f48466><!--[--><!--]--><!--[--><span tabindex="-1" data-v-448eb6bb></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-448eb6bb> Skip to content </a><!--]--><!----><header class="VPNav" data-v-09f48466 data-v-2960f73c><div class="VPNavBar has-sidebar" data-v-2960f73c data-v-239f150d><div class="wrapper" data-v-239f150d><div class="container" data-v-239f150d><div class="title" data-v-239f150d><div class="VPNavBarTitle has-sidebar" data-v-239f150d data-v-0210455f><a class="title" href="/" data-v-0210455f><!--[--><!--]--><!----><span data-v-0210455f>Mongo Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-239f150d><div class="content-body" data-v-239f150d><!--[--><!--]--><div class="VPNavBarSearch search" data-v-239f150d><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-239f150d data-v-b470d34a><span id="main-nav-aria-label" class="visually-hidden" data-v-b470d34a>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-b470d34a data-v-d67861b1><!--[--><span data-v-d67861b1>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-b470d34a data-v-947a1321><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-947a1321><span class="text" data-v-947a1321><!----><span data-v-947a1321>笔记</span><span class="vpi-chevron-down text-icon" data-v-947a1321></span></span></button><div class="menu" data-v-947a1321><div class="VPMenu" data-v-947a1321 data-v-7fe84da0><div class="items" data-v-7fe84da0><!--[--><!--[--><div class="VPMenuLink" data-v-7fe84da0 data-v-68b23d91><a class="VPLink link" href="/note/MySQL.html" data-v-68b23d91><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7fe84da0 data-v-68b23d91><a class="VPLink link" href="/note/Redis.html" data-v-68b23d91><!--[-->Redis<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7fe84da0 data-v-68b23d91><a class="VPLink link active" href="/note/RabbitMQ.html" data-v-68b23d91><!--[-->RabbitMQ<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/project/" tabindex="0" data-v-b470d34a data-v-d67861b1><!--[--><span data-v-d67861b1>项目</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/interview/" tabindex="0" data-v-b470d34a data-v-d67861b1><!--[--><span data-v-d67861b1>面试</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-239f150d data-v-6ec974a7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-6ec974a7 data-v-5812f0ae data-v-e4367a8b><span class="check" data-v-e4367a8b><span class="icon" data-v-e4367a8b><!--[--><span class="vpi-sun sun" data-v-5812f0ae></span><span class="vpi-moon moon" data-v-5812f0ae></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-239f150d data-v-affd6941 data-v-ccefc130><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-ccefc130 data-v-ec01c528><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-239f150d data-v-32102689 data-v-947a1321><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-947a1321><span class="vpi-more-horizontal icon" data-v-947a1321></span></button><div class="menu" data-v-947a1321><div class="VPMenu" data-v-947a1321 data-v-7fe84da0><!----><!--[--><!--[--><!----><div class="group" data-v-32102689><div class="item appearance" data-v-32102689><p class="label" data-v-32102689>Appearance</p><div class="appearance-action" data-v-32102689><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-32102689 data-v-5812f0ae data-v-e4367a8b><span class="check" data-v-e4367a8b><span class="icon" data-v-e4367a8b><!--[--><span class="vpi-sun sun" data-v-5812f0ae></span><span class="vpi-moon moon" data-v-5812f0ae></span><!--]--></span></span></button></div></div></div><div class="group" data-v-32102689><div class="item social-links" data-v-32102689><div class="VPSocialLinks social-links-list" data-v-32102689 data-v-ccefc130><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-ccefc130 data-v-ec01c528><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-239f150d data-v-4fc59892><span class="container" data-v-4fc59892><span class="top" data-v-4fc59892></span><span class="middle" data-v-4fc59892></span><span class="bottom" data-v-4fc59892></span></span></button></div></div></div></div><div class="divider" data-v-239f150d><div class="divider-line" data-v-239f150d></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-09f48466 data-v-0161dced><div class="container" data-v-0161dced><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-0161dced><span class="vpi-align-left menu-icon" data-v-0161dced></span><span class="menu-text" data-v-0161dced>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-0161dced data-v-8512aa94><button data-v-8512aa94>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-09f48466 data-v-53766b84><div class="curtain" data-v-53766b84></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-53766b84><span class="visually-hidden" id="sidebar-aria-label" data-v-53766b84> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-53766b84><section class="VPSidebarItem level-0 has-active" data-v-53766b84 data-v-4d7ec7f6><div class="item" role="button" tabindex="0" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><h2 class="text" data-v-4d7ec7f6>笔记</h2><!----></div><div class="items" data-v-4d7ec7f6><!--[--><section class="VPSidebarItem level-1" data-v-4d7ec7f6 data-v-4d7ec7f6><div class="item" role="button" tabindex="0" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><h3 class="text" data-v-4d7ec7f6>SpringCloud</h3><!----></div><div class="items" data-v-4d7ec7f6><!--[--><div class="VPSidebarItem level-2 is-link" data-v-4d7ec7f6 data-v-4d7ec7f6><div class="item" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><a class="VPLink link link" href="/note/SpringCloud/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.html" data-v-4d7ec7f6><!--[--><p class="text" data-v-4d7ec7f6>注册中心</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-4d7ec7f6 data-v-4d7ec7f6><div class="item" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><a class="VPLink link link" href="/note/Java%E5%9F%BA%E7%A1%80.html" data-v-4d7ec7f6><!--[--><p class="text" data-v-4d7ec7f6>Java基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4d7ec7f6 data-v-4d7ec7f6><div class="item" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><a class="VPLink link link" href="/note/MySQL.html" data-v-4d7ec7f6><!--[--><p class="text" data-v-4d7ec7f6>MySQL</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4d7ec7f6 data-v-4d7ec7f6><div class="item" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><a class="VPLink link link" href="/note/Redis.html" data-v-4d7ec7f6><!--[--><p class="text" data-v-4d7ec7f6>Redis</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4d7ec7f6 data-v-4d7ec7f6><div class="item" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><a class="VPLink link link" href="/note/%E4%BA%8B%E5%8A%A1.html" data-v-4d7ec7f6><!--[--><p class="text" data-v-4d7ec7f6>事务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-4d7ec7f6 data-v-4d7ec7f6><div class="item" data-v-4d7ec7f6><div class="indicator" data-v-4d7ec7f6></div><a class="VPLink link link" href="/note/RabbitMQ.html" data-v-4d7ec7f6><!--[--><p class="text" data-v-4d7ec7f6>RabbitMQ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-09f48466 data-v-6ddd9cad><div class="VPDoc has-sidebar has-aside" data-v-6ddd9cad data-v-f0e6bb9f><!--[--><!--]--><div class="container" data-v-f0e6bb9f><div class="aside" data-v-f0e6bb9f><div class="aside-curtain" data-v-f0e6bb9f></div><div class="aside-container" data-v-f0e6bb9f><div class="aside-content" data-v-f0e6bb9f><div class="VPDocAside" data-v-f0e6bb9f data-v-15ca7508><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-15ca7508 data-v-18b2990b><div class="content" data-v-18b2990b><div class="outline-marker" data-v-18b2990b></div><div class="outline-title" role="heading" aria-level="2" data-v-18b2990b>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-18b2990b><span class="visually-hidden" id="doc-outline-aria-label" data-v-18b2990b> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-18b2990b data-v-13ca2e78><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-15ca7508></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f0e6bb9f><div class="content-container" data-v-f0e6bb9f><!--[--><!--]--><main class="main" data-v-f0e6bb9f><div style="position:relative;" class="vp-doc _note_RabbitMQ" data-v-f0e6bb9f><div><p>Producer(生产者) :生产消息的一方（邮件投递者） Consumer(消费者) :消费消息的一方（邮件收件人）</p><h2 id="exchange-交换器" tabindex="-1">Exchange (交换器) <a class="header-anchor" href="#exchange-交换器" aria-label="Permalink to &quot;Exchange (交换器)&quot;">​</a></h2><p>在 RabbitMQ 中，消息并不是直接被投递到 Queue(消息队列) 中的，中间还必须经过 Exchange(交换器) 这一层，Exchange(交换器) 会把我们的消息分配到对应的 Queue(消息队列) 中。Exchange(交换器) 用来接收生产者发送的消息并将这些消息路由给服务器中的队列中，如果路由不到，或许会返回给 Producer(生产者) ，或许会被直接丢弃掉 。</p><p>RabbitMQ 中通过 Binding(绑定) 将 Exchange(交换器) 与 Queue(消息队列) 关联起来，在绑定的时候一般会指定一个 BindingKey(绑定建) ,这样 RabbitMQ 就知道如何正确将消息路由到队列了。</p><h2 id="queue-消息队列" tabindex="-1">Queue (消息队列) <a class="header-anchor" href="#queue-消息队列" aria-label="Permalink to &quot;Queue (消息队列)&quot;">​</a></h2><p>Queue(消息队列) 用来保存消息直到发送给消费者。它是消息的容器，也是消息的终点。一个消息可投入一个或多个队列。消息一直在队列里面，等待消费者连接到这个队列将其取走。</p><p>多个消费者可以订阅同一个队列，这时队列中的消息会被平均分摊（Round-Robin，即轮询）给多个消费者进行处理，而不是每个消费者都收到所有的消息并处理，这样避免消息被重复消费。</p><h2 id="broker-消息中间件的服务节点" tabindex="-1">Broker（消息中间件的服务节点） <a class="header-anchor" href="#broker-消息中间件的服务节点" aria-label="Permalink to &quot;Broker（消息中间件的服务节点）&quot;">​</a></h2><p>对于 RabbitMQ 来说，一个 RabbitMQ Broker 可以简单地看作一个 RabbitMQ 服务节点，或者 RabbitMQ 服务实例。大多数情况下也可以将一个 RabbitMQ Broker 看作一台 RabbitMQ 服务器。</p><h2 id="message-消息" tabindex="-1">Message (消息) <a class="header-anchor" href="#message-消息" aria-label="Permalink to &quot;Message (消息)&quot;">​</a></h2><p>消息一般由 2 部分组成：消息头（或者说是标签 Label）和 消息体。消息体也可以称为 payLoad ,消息体是不透明的，而消息头则由一系列的可选属性组成，这些属性包括 routing-key（路由键）、priority（相对于其他消息的优先权）、delivery-mode（指出该消息可能需要持久性存储）等。生产者把消息交由 RabbitMQ 后，RabbitMQ 会根据消息头把消息发送给感兴趣的 Consumer(消费者)。</p><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><h3 id="exchange-types-交换器类型" tabindex="-1">Exchange Types(交换器类型) <a class="header-anchor" href="#exchange-types-交换器类型" aria-label="Permalink to &quot;Exchange Types(交换器类型)&quot;">​</a></h3><ol><li><p>fanout</p><blockquote><p>fanout 会把所有发送到该 Exchange 的消息路由到所有与它绑定的 Queue 中，不需要做任何判断操作，所以 fanout 类型是所有的交换机类型里面速度最快的。fanout 类型常用来广播消息。</p></blockquote></li><li><p>direct</p><blockquote><p>direct 类型的 Exchange 会把消息路由到那些 Bindingkey 与 RoutingKey 完全匹配的 Queue 中。</p></blockquote></li><li><p>topic</p><blockquote><p>topic 模糊匹配 使用点号 ‘.’ 分割</p></blockquote><p>BindingKey 中可以存在两种特殊字符串 “<em>” 和 “#” ，用于做模糊匹配，其中“</em>” 用于匹配一个单词，“#” 用于匹配多个单词(可以是零个)。</p></li><li><p>headers</p><blockquote><p>根据消息中的headers属性，进行键值对匹配</p></blockquote></li></ol><h3 id="消息丢失" tabindex="-1">消息丢失 <a class="header-anchor" href="#消息丢失" aria-label="Permalink to &quot;消息丢失&quot;">​</a></h3><ol><li><p>消息未到达交换机</p></li><li><p>消息未到达队列</p></li><li><p>消费者未收到消息</p></li></ol><h3 id="生产者确认机制" tabindex="-1">生产者确认机制 <a class="header-anchor" href="#生产者确认机制" aria-label="Permalink to &quot;生产者确认机制&quot;">​</a></h3><p>RabbitMq提供了publisher confirm机制避免消息发送到MQ过程中丢失。消息发送到MQ之后，会返回一个结果给发送者，表示消息是否处理成功</p><ul><li>回调方法重发</li><li>记录日志</li><li>保存到数据库定时重发，成功后删掉表中的数据</li></ul><h3 id="mq宕机" tabindex="-1">MQ宕机 <a class="header-anchor" href="#mq宕机" aria-label="Permalink to &quot;MQ宕机&quot;">​</a></h3><p>MQ默认是内存存储消息，可以开启消息持久化功能确保缓存在MQ中的消息不丢失</p><ol><li>交换机持久化 <code>new DirectExchange(&quot;simple.direct&quot;, true, false)</code></li><li>队列持久化 <code>QueueBuilder.durable(&quot;simple.queue&quot;).build()</code></li><li>消息持久化 <code>MessageBuilder.withBody().setDeliverMode(MessageDeliverMode.PERSISTENT).build()</code></li></ol><h3 id="消费者确认机制" tabindex="-1">消费者确认机制 <a class="header-anchor" href="#消费者确认机制" aria-label="Permalink to &quot;消费者确认机制&quot;">​</a></h3><p>RabbitMQ支持消费者确认机制，即：消费者处理消息后向MQ发送ack回执，MQ收到ack回执后才会删除该消息</p><ul><li>manual：手动ack，业务代码执行完成后，调用api发送ack。</li><li>auto：自动ack，由spring监测listener是否发生异常，没有异常返回ack，否则返回nack。</li><li>none：关闭ack，MQ假定消费者获取到消息后会成功处理，因此消息投递后立即删除</li></ul><p>利用Spring的retry机制，在消费者出现异常的时候本地重试，设置重试次数，当重试次数达到后，将消息发送给异常交换机，由人工手动处理</p><h3 id="消息重复消费" tabindex="-1">消息重复消费 <a class="header-anchor" href="#消息重复消费" aria-label="Permalink to &quot;消息重复消费&quot;">​</a></h3><ul><li>业务标识唯一ID</li><li>幂等方案：分布式锁、数据库锁</li></ul><h3 id="大量消息堆积" tabindex="-1">大量消息堆积 <a class="header-anchor" href="#大量消息堆积" aria-label="Permalink to &quot;大量消息堆积&quot;">​</a></h3><ol><li>增加消费者</li><li>消费者使用线程池消费</li><li>扩大队列容积，提高堆积上限 <ul><li>设置为惰性队列，基于硬盘存储，时效性降低</li></ul></li></ol></div></div></main><footer class="VPDocFooter" data-v-f0e6bb9f data-v-ba62f331><!--[--><!--]--><!----><nav class="prev-next" data-v-ba62f331><div class="pager" data-v-ba62f331><a class="VPLink link pager-link prev" href="/note/%E4%BA%8B%E5%8A%A1.html" data-v-ba62f331><!--[--><span class="desc" data-v-ba62f331>Previous page</span><span class="title" data-v-ba62f331>事务</span><!--]--></a></div><div class="pager" data-v-ba62f331><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"project_index.md\":\"ERSunx8K\",\"interview_科脉技术.md\":\"CVHY-lH2\",\"note_java基础.md\":\"DEmcV0Av\",\"note_第一篇笔记.md\":\"B4fllKp6\",\"note_springcloud_index.md\":\"Dz9bWn_I\",\"note_index.md\":\"BZzxxxon\",\"note_mysql.md\":\"_p54zaGN\",\"note_redis.md\":\"CaBC19zA\",\"note_rabbitmq.md\":\"Bo6iruvz\",\"note_事务.md\":\"CYA29B8z\",\"note_springcloud_注册中心.md\":\"hP2UOHG6\",\"project_第一个项目.md\":\"tWDzD_1d\",\"interview_index.md\":\"B173Ct1S\",\"index.md\":\"CDg6kd_F\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Mongo Blog\",\"description\":\"A VitePress Blog\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"笔记\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/note/MySQL\"},{\"text\":\"Redis\",\"link\":\"/note/Redis\"},{\"text\":\"RabbitMQ\",\"link\":\"/note/RabbitMQ\"}]},{\"text\":\"项目\",\"link\":\"/project/\"},{\"text\":\"面试\",\"link\":\"/interview/\"}],\"sidebar\":{\"/note/\":[{\"text\":\"笔记\",\"items\":[{\"text\":\"SpringCloud\",\"items\":[{\"text\":\"注册中心\",\"link\":\"/note/SpringCloud/注册中心\"}]},{\"text\":\"Java基础\",\"link\":\"/note/Java基础.md\"},{\"text\":\"MySQL\",\"link\":\"/note/MySQL\"},{\"text\":\"Redis\",\"link\":\"/note/Redis\"},{\"text\":\"事务\",\"link\":\"/note/事务\"},{\"text\":\"RabbitMQ\",\"link\":\"/note/RabbitMQ\"}]}],\"/project/\":[{\"text\":\"项目\",\"items\":[{\"text\":\"第一篇笔记\",\"link\":\"/project/第一个项目\"}]}],\"/interview/\":[{\"text\":\"面试\",\"items\":[{\"text\":\"科脉技术\",\"link\":\"/interview/科脉技术\"},{\"text\":\"面试题\",\"items\":[{\"text\":\"Redis\",\"link\":\"/interview/subject/Redis\"}]}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>